---
  - name: Download and install the jenkins repo
    get_url:
      url: https://pkg.jenkins.io/redhat-stable/jenkins.repo
      dest: /etc/yum.repos.d/jenkins.repo
      mode: 0400

  - name: Install the jenkins RPM key
    rpm_key:
      state: present
      key: https://pkg.jenkins.io/redhat-stable/jenkins.io.key
    notify: Clean the yum repo

  - meta: flush_handlers

  - name: Install jenkins and java.
    yum:
      name: "{{ jenkins_packages }}"
      state: present

  - name: Change jenkins default port
    lineinfile:
      path: /etc/sysconfig/jenkins
      regexp: '^JENKINS_PORT'
      line: JENKINS_PORT="8081"

  - name: Allow port 8081 in firewalld.
    firewalld:
      port: 8081/tcp
      state: enabled
      permanent: yes
    notify:
      - Daemon reload
      - Start services
  